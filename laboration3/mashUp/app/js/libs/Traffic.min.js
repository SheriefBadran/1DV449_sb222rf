/**
 * Created by sheriefbadran on 12/11/14.
 */
var TRAFFIC=TRAFFIC||{};TRAFFIC.namespace=function(a){var d,b=a.split("."),c=TRAFFIC;for("TRAFFIC"===b[0]&&(b=b.slice(1)),d=0;d<b.length;d+=1)"undefined"==typeof c[b[d]]&&(c[b[d]]={}),c=c[b[d]];return c},TRAFFIC.namespace("dom.listRenderer"),TRAFFIC.namespace("events.listenerCallbacks"),TRAFFIC.namespace("google.events"),TRAFFIC.namespace("data.dataHandler"),TRAFFIC.namespace("google.maps.markerRenderer"),TRAFFIC.namespace("google.maps.mapRenderer"),TRAFFIC.namespace("google.maps.infoWindowContent"),TRAFFIC.dom.listRenderer=function(){"use strict";var b,a=document,c=a.createElement("li"),d=a.createElement("a");d.setAttribute("href","");var e,f,g=function(a,g){return e=c.cloneNode(!0),f=d.cloneNode(!0),f.setAttribute("id",g),f.textContent=a.title,e.appendChild(f),b.appendChild(e),e};return{renderMarkerBindedListItems:function(a,c,d){return b=a,g(c,d)}}}(),TRAFFIC.data.dataHandler=function(){"use strict";function b(a){var b={};return a.filter(function(a){return b.hasOwnProperty(a.title)?!1:b[a.title]=!0})}var a={markers:[],roadData:[],publicTransData:[],disruptionData:[],other:[],markerData:[]},c=function(a){return a.forEach(function(a){a.createddate=parseInt(a.createddate.replace("/Date(","").replace(")/",""),10)}),a.sort(function(a,b){return b.createddate-a.createddate}),a=b(a),a=a.slice(0,100),a.map(function(a){return{latitude:a.latitude,longitude:a.longitude,title:a.title,description:a.description,createddate:a.createddate,category:a.category,subcategory:a.subcategory}})},d=function(b){return b.forEach(function(b){switch(b.category){case 0:a.roadData.push(b);break;case 1:a.publicTransData.push(b);break;case 2:a.disruptionData.push(b);break;case 3:a.other.push(b)}}),a},e=function(){a.markers=[],a.roadData=[],a.publicTransData=[],a.disruptionData=[],a.other=[],a.makerData=[]};return{populateCategoryArrays:function(a){return d(a)},clearCategories:function(){e()},setMarkerData:function(b){if(!b.length)throw{errMsg:"markerData has to be an array."};a.markerData=c(b)},getMarkerData:function(){return a.markerData}}}(),TRAFFIC.google.maps.mapRenderer=function(){"use strict";function b(b,c,d){c.center=new google.maps.LatLng(b.latitude,b.longitude),a=new google.maps.Map(d,c)}var a;return{renderGoogleMap:function(a,c,d){b(a,c,d)},getMap:function(){return a instanceof google.maps.Map?a:null}}}(),TRAFFIC.google.maps.infoWindowContent=function(){var a=function(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")};return{getInfoMarkup:function(b){var c=""==b.title?"Titel saknas":a(b.title),d=new Date(b.createddate),e=""==b.description?"Beskrivning saknas.":a(b.description),f=""==b.subcategory?"Underkategori saknas.":a(b.subcategory),g="<div>";return g+="<h4>"+c+" - "+f+"</h4>",g+="<p>"+e+"</p>",g+="<p>"+a(d.toLocaleDateString())+" : "+a(d.toLocaleTimeString())+"</p>"}}}(),TRAFFIC.google.maps.markerRenderer=function(){"use strict";var d,a=TRAFFIC.dom.listRenderer,b=TRAFFIC.google.maps.infoWindowContent,c={markers:[],trafficMessageList:document.querySelector("#traffic-message-list"),listenerHandle:null},e=function(a){a.preventDefault();var b=a.target,d=b.nodeName.toLowerCase();if("a"===d){var e=c.markers[b.id].marker;google.maps.event.trigger(e,"click")}},f=function(){c.markers.forEach(function(a){a.marker.setMap(null)}),c.markers=[]},g=function(a){c.listenerHandle=google.maps.event.addDomListener(a,"click",e)},h=function(e,f,g){g.textContent="";var h=new google.maps.InfoWindow;f.forEach(function(f,i){var j=b.getInfoMarkup(f),k=new google.maps.LatLng(f.latitude,f.longitude),l=new google.maps.Marker({position:k,map:e,title:f.title,infoWindow:h}),m=a.renderMarkerBindedListItems(g,l,i),n={marker:l,li:m};c.markers.push(n),google.maps.event.addListener(l,"click",function(){d&&d.infoWindow.close(),e.setZoom(6),e.setCenter(k),h.setContent(j),l.infoWindow.open(e,l),d=l})})};return{getListenerHandle:function(){return c.listenerHandle},clearPreviousMarkers:function(){f()},bindMarkersToList:function(a){g(a)},createMarkers:function(a,b,c){h(a,b,c)}}}();